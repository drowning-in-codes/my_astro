<<<<<<< HEAD
---
title: 'Reactå­¦ä¹ '
description: 'Reactå­¦ä¹ å†ç¨‹'
pubDate: 'Aug 28 2023'
heroImage: '/placeholder-hero.jpg'
---

åœ¨å­¦ä¹ Reactæ—¶ä¸ºäº†æ›´å¥½å¤„ç†æ•°ç»„ä»¥åŠå¯¹è±¡éœ€è¦æ›´ä»”ç»†äº†è§£æ•°ç»„ä»¥åŠå¯¹è±¡çš„ä¸€äº›æ–¹æ³•ã€‚è¿™é‡Œåšä¸€ç‚¹ç®€å•ä»‹ç»ã€‚
=======
åœ¨å­¦ä¹ Reactæ—¶ä¸ºäº†æ›´å¥½å¤„ç†æ•°ç»„ä»¥åŠå¯¹è±¡éœ€è¦æ›´ä»”ç»†äº†è§£æ•°ç»„ä»¥åŠå¯¹è±¡çš„ä¸€äº›æ–¹æ³•ã€‚è¿™é‡Œåšä¸€ç‚¹ç®€å•ä»‹ç»ã€‚

>>>>>>> 955e31521695add3a06c2a4725a843fd5a4f687f
### åŸå‹

ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª `user` å¯¹è±¡åŠå…¶å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶å¸Œæœ›å°† `admin` å’Œ `guest` ä½œä¸ºåŸºäº `user` ç¨åŠ ä¿®æ”¹çš„å˜ä½“ã€‚æˆ‘ä»¬æƒ³é‡ç”¨ `user` ä¸­çš„å†…å®¹ï¼Œè€Œä¸æ˜¯å¤åˆ¶/é‡æ–°å®ç°å®ƒçš„æ–¹æ³•ï¼Œè€Œåªæ˜¯åœ¨å…¶ä¹‹ä¸Šæ„å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚  (è·Ÿç±»ç»§æ‰¿æœ‰ä»€ä¹ˆå·®åˆ«?)

![image-20230629091929434](https://i.imgur.com/hKO4ZLn.png)


### æ•°ç»„ã€å¯¹è±¡è§£æ„

[Rest å‚æ•°ä¸ Spread è¯­æ³• (javascript.info)](https://zh.javascript.info/rest-parameters-spread)

åœ¨JavaScriptä¸­,å‡½æ•°æ”¯æŒä»»æ„æ•°é‡çš„å‚æ•°.è¿™åœ¨å…¶ä»–è¯­è¨€æ˜¯å¹¶ä¸å¤šçš„,ä¸»è¦ä½¿ç”¨Restå‚æ•°ä»¥åŠSpreadè¯­æ³•.


### React è¯¾ç¨‹

#### Side effect

![image-20230629205525138](https://i.imgur.com/hYpAuLH.png)

Render logic must produce no side effects

<img src="https://i.imgur.com/60YRKQC.png" alt="image-20230629210229838" style="zoom:50%;" />



#### Batched State Update

![image-20230629211505890](https://i.imgur.com/MzXAjOG.png)



<img src="https://i.imgur.com/RqzJ7MB.png" alt="image-20230629213459755" style="zoom:67%;" />

### Lazy render

ä½¿ç”¨å‡½æ•°ä½œä¸ºuseStateå‚æ•°,åªåœ¨åˆå§‹æ¸²æŸ“æ—¶è°ƒç”¨.

```jsx
const [fun, setfun] = useState(()=>{console.log('æˆ‘æ˜¯åˆå§‹åŒ–å‡½æ•°')});
```

å¦‚æœä¼ å…¥å‡½æ•°è°ƒç”¨æ¯”å¦‚func(),é‚£ä¹ˆæ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°,è¿™æ˜¯ä¸å¿…è¦çš„.





### event delegation

![image-20230629221856169](https://i.imgur.com/gveeRn0.png)





### Effect

![](https://i.imgur.com/v8qdnbh.png)

use effect to in sync with external world

events used to react to an event



#### Loading State

<img src="https://i.imgur.com/gslOiDF.png" alt="image-20230630152136432" style="zoom:67%;" />



### UseEffect Dependency

<img src="https://i.imgur.com/j0RR2hQ.png" alt="image-20230630165038444" style="zoom:67%;" />



<img src="https://i.imgur.com/5gIRbUa.png" alt="image-20230630172759218" style="zoom:67%;" />





  

### CleanUp function

<img src="https://i.imgur.com/7E8gtFO.png" alt="image-20230701103622083" style="zoom:50%;" />



 

### KeyPress Event

```js
  useEffect(() => {
    document.addEventListener("keydown", (e) => {
      if (e.code === "Backspace") {
        // setSelectedID(null);
        handleRestID();
      }
      return () => {
        document.removeEventListener("keydown");
      };
    });
  }, []);
```

### Hook

<img src="https://i.imgur.com/A7QCiZ3.png" alt="image-20230704094357819" style="zoom:67%;" />

![image-20230704094632007](https://i.imgur.com/41IcNUW.png)

1. Hooks can only be called at the top level
2. only call hooks from react function



<img src="https://i.imgur.com/aZxXTgK.png" alt="image-20230704095528996" style="zoom:50%;" />



åˆ©ç”¨æœ¬åœ°å­˜å‚¨(LocalStorage)æˆ–è€…æ•°æ®åº“ä¸StateåŒæ­¥.

<img src="https://i.imgur.com/Kixke6T.png" alt="image-20230704151458991" style="zoom:67%;" />



### Ref

<img src="https://i.imgur.com/7mz0oQq.png" alt="image-20230704153819337" style="zoom:50%;" />







![image-20230704154015968](https://i.imgur.com/2aKNR7G.png)



Not trigger re-render



### Custom Hook

<img src="https://i.imgur.com/kNJmf6Y.png" alt="image-20230704172850175" style="zoom:50%;" />





### Class-Based React

Before React v16.8 ....

<img src="https://i.imgur.com/U5advPB.png" alt="image-20230705120827255" style="zoom:67%;" />



### Child to component communication

Props



### useReducer

<img src="https://i.imgur.com/95L9Q3D.png" alt="image-20230719194739004" style="zoom:67%;" />



```js
function reducer(state, action) {
  console.log(state, action); //ç°åœ¨çš„state,actionä¸ºdispatchä¼ å…¥çš„å€¼
    return state+action;//è¿”å›æ–°çš„state
}
-------------------------------------
const [count, dispatch] = useReducer(reducer, 0); // 0åˆå§‹å€¼ reduceræ–¹æ³•
```

```js
function reducer(state, action) {
  console.log(state, action);
  switch (action.type) {
    case "dec":
      return { ...state, count: state.count - state.step };
    case "inc":
      return { ...state, count: state.count + state.step };
    case "setCount":
      return { ...state, count: action.payload };
    case "setStep":
      return { ...state, step: action.payload };
    case "reset":
      return initialState;
    default:
      throw new Error("Invalid action type");
  }
}
```



<img src="https://i.imgur.com/tYyfLrY.png" alt="image-20230719211122503" style="zoom:67%;" />



<img src="https://i.imgur.com/5OuQFhc.png" alt="image-20230719211537357" style="zoom: 50%;" />



![image-20230719213544488](https://i.imgur.com/OlkxXJm.png)



<img src="https://i.imgur.com/0FBjOlE.png" alt="image-20230720223544740" style="zoom:67%;" />

 

![image-20230720223816907](https://i.imgur.com/n5pa5St.png)



å¤šä½¿ç”¨jsä¸­æ•°ç»„å’Œå¯¹è±¡çš„ä¸€äº›æ–¹æ³•.æ¯”å¦‚æ•°ç»„çš„map,reduceç­‰,ä»¥åŠrest,spreadè¯­æ³•



### React Router

ä½¿ç”¨Viteè€Œä¸æ˜¯å·²ç»è¿‡æ—¶çš„creat-react-app

<img src="https://i.imgur.com/lNo0MTw.png" alt="image-20230720224928308" style="zoom: 80%;" />

viteé…ç½®ESLint,å®‰è£…viteçš„eslintæ’ä»¶

```bash
 npm i vite-plugin-eslint --save-dev
```

åœ¨vite.config.jsä¸­é…ç½®eslint

```js
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import eslint from "vite-plugin-eslint";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react(), eslint()],
});

```

é¡¹ç›®ç›®å½•ä¸‹å·²ç»æœ‰äº†.eslintrc.cjs

```js
module.exports = {
  root: true,
  env: { browser: true, es2020: true },
  extends: [
    'eslint:recommended',
    'react-app',
    'plugin:react/recommended',
    'plugin:react/jsx-runtime',
    'plugin:react-hooks/recommended',
  ],
  ignorePatterns: ['dist', '.eslintrc.cjs'],
  parserOptions: { ecmaVersion: 'latest', sourceType: 'module' },
  settings: { react: { version: '18.2' } },
  plugins: ['react-refresh'],
  rules: {
    'react-refresh/only-export-components': [
      'warn',
      { allowConstantExport: true },
    ],
  },
}
```



<img src="https://i.imgur.com/PWNM0Sr.png" alt="image-20230721102641673"  />





![image-20230721104329081](https://i.imgur.com/27YOnHq.png)



**å¤šé¡µåº”ç”¨ (MPAï¼ŒMulti-Page Application)** æ˜¯ä¸€ä¸ªç”±å¤šä¸ª HTML é¡µé¢ç»„æˆçš„ç½‘ç«™ï¼Œä¸»è¦åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“ã€‚å½“æ‚¨å¯¼èˆªåˆ°ä¸€ä¸ªæ–°é¡µé¢æ—¶ï¼Œæ‚¨çš„æµè§ˆå™¨ä¼šä»æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªæ–°çš„ HTML é¡µé¢ã€‚**Astro æ˜¯ä¸€ä¸ª MPA æ¡†æ¶ã€‚** ä¼ ç»Ÿçš„ MPA æ¡†æ¶è¿˜åŒ…æ‹¬ Ruby on Railsã€Python Djangoã€PHP Laravelã€WordPressã€Joomlaã€Drupal å’Œé™æ€ç½‘ç«™æ„å»ºå™¨ï¼Œå¦‚ Eleventy æˆ– Hugoã€‚

**å•é¡µåº”ç”¨(SPAï¼ŒSingle-Page Application)** æ˜¯ä¸€ä¸ªç”±å•ä¸ª JavaScript åº”ç”¨ç¨‹åºç»„æˆçš„ç½‘ç«™ï¼Œè¯¥åº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­åŠ è½½ï¼Œç„¶ååœ¨æœ¬åœ°å‘ˆç° HTMLã€‚SPA ä¹Ÿå¯èƒ½åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆ HTMLï¼Œä½† SPA çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºå®ƒä»¬èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­å°†æ‚¨çš„ç½‘ç«™ä½œä¸º JavaScript åº”ç”¨ç¨‹åºè¿è¡Œï¼Œä»¥ä¾¿åœ¨æ‚¨å¯¼èˆªæ—¶å‘ˆç°æ–°çš„ HTML é¡µé¢ã€‚æ­¤å¤–ï¼Œ Next.jsã€Nuxtã€SvelteKitã€Remixã€Gatsby å’Œ Create React App éƒ½æ˜¯ SPA æ¡†æ¶çš„ç¤ºä¾‹ã€‚

>Astro æ˜¯ä¸€ä¸ª MPA æ¡†æ¶ã€‚ç„¶è€Œï¼ŒAstro ä¹Ÿä¸åŒäºå…¶ä»– MPA æ¡†æ¶ã€‚å®ƒçš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä½¿ç”¨ JavaScript ä½œä¸ºå…¶æœåŠ¡å™¨è¯­è¨€å’Œè¿è¡Œæ—¶ã€‚ä¼ ç»Ÿçš„ MPA æ¡†æ¶ä¼šè®©æ‚¨åœ¨æœåŠ¡å™¨ä¸Šç¼–å†™ä¸åŒçš„è¯­è¨€ï¼ˆRubyã€PHP ç­‰ï¼‰å¹¶åœ¨æµè§ˆå™¨ä¸Šç¼–å†™ JavaScriptã€‚åœ¨ Astro ä¸­ï¼Œæ‚¨æ€»æ˜¯åªæ˜¯åœ¨ç¼–å†™ JavaScriptã€HTML å’Œ CSSã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸Šå‘ˆç°æ‚¨çš„ UI ç»„ä»¶ï¼ˆå¦‚ React å’Œ Svelteï¼‰ã€‚
>
>å…¶ç»“æœæ˜¯å¼€å‘äººå‘˜ä½“éªŒå¾ˆåƒ Next.js å’Œå…¶ä»–ç°ä»£ Web æ¡†æ¶ï¼Œä½†å…·æœ‰æ›´ä¼ ç»Ÿçš„ MPA ç«™ç‚¹æ¶æ„çš„æ€§èƒ½ç‰¹å¾ã€‚

<img src="https://i.imgur.com/kjqKJJ7.png" alt="image-20230721114237353" style="zoom:67%;" />



ä½¿ç”¨Linkæˆ–è€…NavLinké“¾æ¥è¿›è¡Œè·³è½¬

![image-20230721120202775](https://i.imgur.com/4Mu2KiK.png)



![image-20230721120211998](https://i.imgur.com/P68cGM9.png)



![img](https://pic2.zhimg.com/80/v2-a85036113478c3bc36062f76ef8e66bd_720w.webp)



![img](https://pic4.zhimg.com/80/v2-e44eab840072dc00011854928fb0bcaf_720w.webp)

### styling

![image-20230721120758282](https://i.imgur.com/I2Fghp5.png)

è¿™é‡Œä¸»è¦ä»‹ç»CSS Moduleæ–¹æ³•.



åˆ›å»ºcomponents,æ¯”å¦‚AppLayout.jsx,å†åˆ›å»ºcss,æ¯”å¦‚AppLayout.module.css

```css
.nav {
  background-color: orangered;
}

.nav ul {
  display: flex;
  justify-content: space-around;
  list-style: none;
  background-color: orangered;
}

```

```js
import styles from "./pageNav.module.css";

export default function PageNav() {
  return (
    <nav className={styles.nav}>
      <ul>
        <li>
          <Link to="/">Home</Link>
        </li>
        <li>
          <NavLink to="/pricing">pricing</NavLink>
        </li>
        <li>
          <NavLink to="/product">product</NavLink>
        </li>
      </ul>
    </nav>
  );
}

```

æ³¨æ„:global()çš„ä½¿ç”¨

å…¨å±€cssç›´æ¥åœ¨App.jsxä¸­ä½¿ç”¨å³å¯.

### Nested Routes and index Route

åµŒå¥—è·¯ç”± 

```jsx
<Route path="app" element={<AppLayout />}>
  <Route path="cities" element={<p>List of cities</p>} />
  <Route path="countries" element={<p>Countries</p>} />
  <Route path="form" element={<p>Form</p>} />
  </Route>
```

```jsx
import styles from "./Sidebar.module.css";
import AppNav from "./AppNav";
import Logo from "./Logo";
import { Outlet } from "react-router-dom";

export default function Sidebar() {
  return (
    <div className={styles.sidebar}>
      <Logo />
      <AppNav />
      <Outlet /> //å‡ºå£
      <footer className={styles.footer}>
        <p className="styles copyright">
          &copy; copyright {new Date().getFullYear()} by WorldWise Inc.
        </p>
      </footer>
    </div>
  );
}

```



### The Url for state managemet

![image-20230721225507118](https://i.imgur.com/4Niqiku.png)

### dynamic routes with url paremeter

ä½¿ç”¨`Route`pathå±æ€§å¯¹å€¼åŒ¹é…

```jsx
<BrowserRouter>
<Routes>
{/* <Route path="/" element={<HomePage />} /> */}
<Route index element={<HomePage />} />
<Route path="product" element={<Product />} />
<Route path="pricing" element={<Pricing />} />
<Route path="app" element={<AppLayout />}>

<Route
index
element={<CityList cities={cities} isLoading={isLoading} />}
/>
<Route path="cities/:id" element={<City />} />
<Route
path="cities"
element={<CityList cities={cities} isLoading={isLoading} />}
/>
<Route
path="countries"
element={<CountriesList cities={cities} isLoading={isLoading} />}
/>
<Route path="form" element={<p>Form</p>} />
</Route>
<Route path="login" element={<Login />} />
<Route path="*" element={<PageNotFound />} />
</Routes>
</BrowserRouter>
```

å¯ä»¥ä½¿ç”¨`Link`è¿›è¡Œè·¯ç”±è·³è½¬,ä½¿ç”¨toæŒ‡å®š

```react
<Link className={styles.cityItem} to={`${id}?lat=${position.lat}&lng=${position.lng}`}>
<span className={styles.emoji}>{emoji}</span>
<h3 className={styles.name}>{cityName}</h3>
<time className={styles.data}>({formatDate(date)})</time>
<button className={styles.deleteBtn}>&times; </button>
</Link>
```

ä½¿ç”¨useParamsä»¥åŠuseSearchParamsè·å–urlçš„å‚æ•°.

```react
const x =  useParams()
console.log(x)
const params = useSearchParams();
console.log(params);
```

å‡è®¾urlæœ€åæ˜¯`73930385?lat=38.727881642324164&lng=-9.140900099907554`

é‚£ä¹ˆ`73930385`å°±æ˜¯x,parmså°±æ˜¯ä¸€ä¸ªå¯¹è±¡,åŒ…å«latä»¥åŠlng.



### useNavigate

ç¼–ç¨‹å¼å¯¼èˆª,è€Œä¸æ˜¯ä½¿ç”¨<Link>æˆ–è€…<NavLink>

é¦–å…ˆä¹Ÿéœ€è¦å£°æ˜è·¯ç”±

```jsx
const navigate = useNavigate();

<Button
type="back"
onClick={(e) => {
e.preventDefault(); //å¦‚æœåœ¨è¡¨å•formé‡Œä½¿ç”¨,ç‚¹å‡»æŒ‰é’®ä¼šåˆ·æ–° æ‰€æœ‰éœ€è¦é¿å…é»˜è®¤è¡Œä¸º
navigate(-1);
}}
>
&larr; Back
</Button>
```

```jsx
<div
className={styles.mapContainer}
onClick={() => {
navigate("form");
}}
>
<h1>Map</h1>
<h1>
Position:{lat},{lng}
</h1>
{/* <button onClick={() => setSearchParams({ lat: 23 })}>Click me</button> */}
</div>
```



### Navigateç»„ä»¶

ä¹Ÿæ˜¯`react-router-dom`åº“é‡Œçš„ä¸œè¥¿,ä¹‹å‰è¿˜ä½¿ç”¨è¿‡äº†BrowserRouter, Route, Routesè¿™äº›ç»„ä»¶ä»¥åŠuseNavigate,useSearchParamsä»¥åŠuseParamsè¿™äº›hooks.

```jsx
<Route path="app" element={<AppLayout />}>
<Route
  index
  element={<Navigate to="cities"/>}
/>
 <Route
  path="cities"
  element={<CityList cities={cities} isLoading={isLoading} />}
/>
<Route path="cities/:id" element={<City />} />
<Route
  path="countries"
  element={<CountriesList cities={cities} isLoading={isLoading} />}
/>
<Route path="form" element={<Form />} />
</Route>
```

ä½¿ç”¨`Navigate`é‡å®šå‘åˆ°å…ˆå®šä¹‰çš„Route,ä½†æ˜¯å­˜åœ¨æµè§ˆå™¨ä¸Šæ— æ³•ä½¿ç”¨æµè§ˆå™¨åé€€.

ä½¿ç”¨replaceæ›¿æ¢.

[æµ…æreact-router@6ç‰ˆæœ¬ä¸­ï¼ŒNavigateç»„ä»¶é‡å®šå‘è·¯ç”±çš„ä½¿ç”¨ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7070309762759393317)

```javascript
import React from "react";
import { BrowserRouter as Router, Link } from "react-router-dom";
import { Routes, Route, Navigate, useRoutes } from "react-router";

const Child = () => {
  return <div>1 aaa</div>;
};

const Child2 = () => {
  return <div>2 bbb</div>;
};
export default function App() {
  return (
    <div>
      <Router>
        <Link to={"/aaa"}>to 1 aaa</Link>
        <hr />
        <Link to="/bbb">to 2 bbb</Link>
        <hr />
        <Link to="/ccc">to 3 cc</Link>
        <hr />
        <Routes>
          <Route path="aaa" element={<Child />}></Route>
          <Route path="bbb" element={<Child2 />}></Route>
          <Route path="*" element={<Navigate to={"aaa"} replace />}></Route>
        </Routes>
      </Router>
    </div>
  );
}
```

> è¿™æ®µä»£ç ï¼Œåªèƒ½è®¿é—®`/aaa`å’Œ`/bbb`ï¼Œè®¿é—®å…¶ä»–è·¯ç”±éƒ½ä¼šè¢«æ•è·å¹¶é‡æ–°è·³è½¬è‡³`/aaa`ï¼Œ`Navigate`çš„`replace`å¦‚æœä¸åŠ çš„è¯åˆ™æ— æ³•åé€€ï¼Œå› ä¸º`/aaa`-->`/sdjfklsadj`-->`/aaa`çš„åœºæ™¯ä¸‹ï¼Œé”™è¯¯çš„è·¯ç”±å®é™…ä¸Šä¼šè¢«è®°å½•åˆ°å†å²æ ˆä¸­ï¼Œç‚¹å‡»åé€€ä¼šé€€å›åˆ°é”™è¯¯çš„è·¯ç”±ï¼Œå¹¶åˆå†æ¬¡åŒ¹é…åˆ°ä¸”è·³è½¬ä¼š`/aaa`ï¼ŒåŠ äº†`replace`åå†å²æ ˆåˆ™ä¼šå˜æˆ`/aaa`->`/aaa`



### Context

è§£å†³props drillingé—®é¢˜,ç®€å•æƒ…å†µä¸‹çš„è§£å†³æ–¹æ¡ˆæ˜¯å®‰æ’å¥½ç»„ä»¶çš„ç»“æ„ã€‚

![image-20230722122553772](https://i.imgur.com/QEWuEjx.png)





![image-20230722122746394](https://i.imgur.com/XQCjAgw.png)

å…·ä½“ä½¿ç”¨æ–¹æ³•,ä½¿ç”¨createContext,providerä»¥åŠuseContext.

```jsx
//  1) create a new CONTEXT
const PostContext = createContext();
// 2) provide value to child components
<PostContext.Provider
  value={{
    posts: searchedPosts,
    onAddPost: handleAddPost,
    onClearPosts: handleClearPosts,
    searchQuery,
    setSearchQuery,
  }}
>
  <section>
    <button
      onClick={() => setIsFakeDark((isFakeDark) => !isFakeDark)}
      className="btn-fake-dark-mode"
    >
      {isFakeDark ? "â˜€ï¸" : "ğŸŒ™"}
    </button>
    <Header />
    <Main posts={searchedPosts} onAddPost={handleAddPost} />
    <Archive onAddPost={handleAddPost} />
    <Footer />
  </section>
</PostContext.Provider>

//3. consuming context
const { onClearPosts } = useContext(PostContext);
return (
<header>
  <h1>
    <span>âš›ï¸</span>The Atomic Blog
  </h1>
  <div>
    <Results />
    <SearchPosts />
    <button onClick={onClearPosts}>Clear posts</button>
  </div>
</header>
);

```

Provierç»„ä»¶ä¸‹çš„ç»„ä»¶èƒ½ä½¿ç”¨useContextè·å–æä¾›çš„value.

### åˆ›å»ºè‡ªå·±çš„Context

```jsx
import { createContext, useState } from "react";
import { faker } from "@faker-js/faker";

function createRandomPost() {
  return {
    title: `${faker.hacker.adjective()} ${faker.hacker.noun()}`,
    body: faker.hacker.phrase(),
  };
}

const PostContext = createContext();

function PostProvider({ children }) {
  const [posts, setPosts] = useState(() =>
    Array.from({ length: 30 }, () => createRandomPost())
  );
  const [searchQuery, setSearchQuery] = useState("");

  // Derived state. These are the posts that will actually be displayed
  const searchedPosts =
    searchQuery.length > 0
      ? posts.filter((post) =>
          `${post.title} ${post.body}`
            .toLowerCase()
            .includes(searchQuery.toLowerCase())
        )
      : posts;

  function handleAddPost(post) {
    setPosts((posts) => [post, ...posts]);
  }

  function handleClearPosts() {
    setPosts([]);
  }

  return (
    <PostContext.Provider
      value={{
        posts: searchedPosts,
        onAddPost: handleAddPost,
        onClearPosts: handleClearPosts,
        searchQuery,
        setSearchQuery,
      }}
    >
      {children}
    </PostContext.Provider>
  );
}

export { PostContext, PostProvider };
```

ä½¿ç”¨PostContextä»¥åŠPostProvider

```jsx
<PostProvider>
<Header />
<Main />
<Archive />
<Footer />
</PostProvider>
```



æ­¤å¤–è¿˜å¯ä»¥å°†Contextä¸Hooksç»“åˆ,

### State Management

![image-20230722213239850](https://i.imgur.com/lbVs3x2.png)



![image-20230722214449124](https://i.imgur.com/De155qS.png)



![image-20230722214632055](https://i.imgur.com/I4AmAk3.png)



![image-20230722215215386](https://i.imgur.com/Ti5HKQi.png)

![image-20230722215641687](https://i.imgur.com/gfqkLu9.png)



### Performance optimization tools

1. é˜²æ­¢å¤šæ¬¡æ¸²æŸ“

2. æå‡åº”ç”¨å“åº”é€Ÿåº¦ä»¥åŠè‡ªé€‚åº”

3. å‡å°Bundleå¤§å°

![image-20230725112743326](https://i.imgur.com/qrn8N67.png)



![image-20230725113652608](https://i.imgur.com/iPJ46hc.png)



ä½¿ç”¨Reactå¼€å‘è€…å·¥å…· Profilerè°ƒä¼˜  å°†ç»„ä»¶ä»¥childrenæˆ–è€…propså½¢å¼ä¼ å…¥

```jsx
import { useState } from "react";

function SlowComponent() {
  // If this is too slow on your maching, reduce the `length`
  const words = Array.from({ length: 100_000 }, () => "WORD");
  return (
    <ul>
      {words.map((word, i) => (
        <li key={i}>
          {i}: {word}
        </li>
      ))}
    </ul>
  );
}

export default function Test() {
  const [count, setCount] = useState(0);
  return (
    <div>
      <h1>Slow counter?!?</h1>
      <button onClick={() => setCount((c) => c + 1)}>Increase: {count}</button>
      <SlowComponent />
    </div>
  );
}
// æ¯”è¾ƒå‰åå·®å¼‚
function Counter({children}){

  const [count, setCount] = useState(0);
  return (
    <div>
      <h1>Slow counter?!?</h1>
      <button onClick={() => setCount((c) => c + 1)}>Increase: {count}</button>
     {children}
    </div>
  );

}

export default function Test() {
 
  return (
    <div>
     <Counter><SlowComponent/></Counter>
    </div>
  );
}
```



### Memo

<img src="https://i.imgur.com/pbMq2VY.png" alt="image-20230725172157384" style="zoom:50%;" />



![image-20230725172255986](https://i.imgur.com/g2JKy9E.png)



![image-20230725172704934](https://i.imgur.com/bwW8KRe.png)

é»˜è®¤æƒ…å†µä¸‹,çˆ¶ç»„ä»¶render,æ‰€æœ‰å­ç»„ä»¶éƒ½ä¼šé‡æ–°render.

memo ç”¨åœ¨ç»å¸¸renderçš„ç»„ä»¶,å…¶propsé€šå¸¸ä¸å˜,è€Œä¸”é€šå¸¸åŠ è½½è¾ƒæ…¢.

![image-20230725180523756](https://i.imgur.com/KjeAKX2.png)

![image-20230725180550423](https://i.imgur.com/TxMIFb4.png)



propsä¼ ç»™å­ç»„ä»¶æ—¶,å¦‚æœä¼ çš„æ˜¯å‡½æ•°å’Œå¯¹è±¡,åœ¨re-renderä¹‹åå†…å­˜åœ°å€æ”¹å˜,æ‰€ä»¥å˜å¾—ä¸åŒå,Memoå°±å˜å¾—ä¸workäº†.

è§£å†³æ–¹æ¡ˆ:useCallback  useMemo

####   useMemo

<img src="https://i.imgur.com/pjgIyJv.png" alt="image-20230725181111554" style="zoom:50%;" />

![image-20230725181308686](https://i.imgur.com/nUZpukQ.png)

```jsx
const archiveOptions = useMemo(() => {
return {
show: false,
title: `Post archive in addition to main posts ${posts.length}`,
};
}, [posts.length]);
<Archive archiveOptions={archiveOptions} onAddPost={handleAddPost} />
```

ä½¿ç”¨useMemo,ä½¿å¾—åœ¨å·²ç»ä½¿ç”¨äº†Memoç¼“å­˜å­ç»„ä»¶ä¹‹å,ä¼ é€’å¯¹è±¡props,åªè¦useMemoçš„ä¾èµ–ä¸æ”¹å˜,åˆ™archiveOptionså°±ä¸ä¼šæ”¹å˜,ä½¿å¾—ä¼ é€’å¯¹è±¡propsä¹Ÿèƒ½ç¼“å­˜å­ç»„ä»¶.

#### useCallback

```js
const handleAddPost = useCallback(function handleAddPost(post) {
setPosts((posts) => [post, ...posts]);
}, []);
<Archive archiveOptions={archiveOptions} onAddPost={handleAddPost} />
```

è¿™æ ·å½“çˆ¶ç»„ä»¶re-renderæ—¶,handleAddPostä¸ä¼šå˜,ä¹Ÿå°±ä¸ä¼šåœ¨æ›´æ–°å­ç»„ä»¶.



stateçš„setterå‡½æ•°ä½œä¸ºå­ç»„ä»¶çš„props,çˆ¶ç»„ä»¶render,å­ç»„ä»¶ä¸ä¼šé‡æ–°render



**memoç›®çš„æ˜¯ç¼“å­˜å­ç»„ä»¶,ä½¿å¾—åœ¨ä¼ é€’ç›¸åŒpropsä¸‹,çˆ¶ç»„ä»¶render,å…¶ä¸å†render**

**è€Œç”±äºçˆ¶ç»„ä»¶renderæ—¶,å¯¹è±¡ä¸å‡½æ•°ä¼šå†æ¬¡åˆ›å»º,å› ä¸ºéPrimitiveæ•°æ®,å€¼ä¸å†ç›¸åŒ,æ‰€ä»¥éœ€è¦ä½¿å¯¹è±¡ä¸å‡½æ•°`ç¨³å®š`**

**è€ŒuseMemoä¸useCallbackå°±æ˜¯åˆ†åˆ«ä½¿å¾—å¯¹è±¡ä¸å‡½æ•°ç¨³å®šçš„**,æ­¤å¤–ä¹Ÿå¯ä»¥ç”¨åœ¨useEffectç­‰çš„ä¾èµ–ä¸Š,ä»¥åŠç”¨äºå­˜å‚¨æ•°æ®é¿å…æ¯æ¬¡re-renderæ—¶çš„æ¶ˆè€—,å¦‚æœå€¼ä¸å˜å¯ä»¥ä½¿ç”¨Lazy state,å³ä½¿ç”¨useState(func);ä½¿ç”¨funcè¿”å›å€¼ä½œä¸ºstate,ä¸”åªåˆå§‹åŒ–ç¬¬ä¸€æ¬¡render.

### Optimizing Bundle Size with Code spliting

æ¶‰åŠåˆ°SPA

![](https://i.imgur.com/26oWVhE.png)



#### Page/Route Level

é¦–å…ˆ`npm run build`ä¹‹å,

![image-20230725231202258](https://i.imgur.com/eMuEPQf.png)

å¾—åˆ°çš„bundle,å°±æ˜¯åªæœ‰html,css,js. åˆ°æ—¶å€™å°±æ˜¯æŠŠè¿™äº›æ–‡ä»¶æ”¾æœåŠ¡å™¨,ç„¶åæµè§ˆå™¨ä¸‹è½½è¿™å‡ ä¸ªæ–‡ä»¶å¹¶è¿›è¡Œæ¸²æŸ“.

å¯ä»¥æ³¨æ„åˆ°æç¤ºè¯´ä¸€äº›chunkså¤§é›¨äº†500kB,è¿™é‡ŒæŒ‡çš„å°±æ˜¯æˆ‘ä»¬çš„jsæ–‡ä»¶.æ‰€ä»¥éœ€è¦ä½¿ç”¨åŠ¨æ€å¯¼å…¥,æˆ–è€…å«æ‡’åŠ è½½.

**Suspense**

```jsx
const HomePage = lazy(() => import("./pages/Homepage"));
const Product = lazy(() => import("./pages/Product"));
const Pricing = lazy(() => import("./pages/Pricing"));
const Login = lazy(() => import("./pages/Login"));
const AppLayout = lazy(() => import("./pages/AppLayout"));
const PageNotFound = lazy(() => import("./pages/PageNotFound"));


<Suspense fallback={<Spinner />}>
<Routes>
  {/* <Route path="/" element={<HomePage />} /> */}
  <Route index element={<HomePage />} />
  <Route path="product" element={<Product />} />
  <Route path="pricing" element={<Pricing />} />
  <Route
    path="app"
    element={
      <ProtectedRoute>
        <AppLayout />
      </ProtectedRoute>
    }
  >
    <Route index element={<Navigate to="cities" replace />} />
    <Route path="cities" element={<CityList />} />
    <Route path="cities/:id" element={<City />} />
    <Route path="countries" element={<CountriesList />} />
    <Route path="form" element={<Form />} />
  </Route>
  <Route path="login" element={<Login />} />
  <Route path="*" element={<PageNotFound />} />
</Routes>
</Suspense>

```

`lazy import`+`Suspense`  æ‡’åŠ è½½é…åˆ Suspense

æ¯ä¸ªæ‡’åŠ è½½çš„ç»„ä»¶å¯ä»¥æˆä¸ºchunk,è¿™æ ·åšç”¨æˆ·å¦‚æœæ²¡æœ‰ä½¿ç”¨åˆ°æŸä¸ªç»„ä»¶,æœåŠ¡å™¨ä¹Ÿä¸ä¼šå‘é€é‚£ä¸ªç»„ä»¶,æ‰€ä»¥æµè§ˆå™¨è¯·æ±‚çš„æ•°æ®å°±ä¼šå°‘ä¸€äº›,åˆæ¬¡æ¸²æŸ“çš„ä¸œè¥¿å°±è¦å°‘ä¸€äº›

å†æ¬¡buildä¸€ä¸‹,å‘ç°jsä¸csséƒ½è‡ªåŠ¨åˆ†ä¸ºäº†å¤šä¸ªchunk,æ³¨æ„chunksä¸lazy importå¯¼å…¥çš„æ¯ä¸ªç»„ä»¶å¹¶ä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„.

![image-20230726111935461](https://i.imgur.com/WMNstM7.png)



![image-20230726113518925](https://i.imgur.com/7pNSFjh.png)





![image-20230726114014011](https://i.imgur.com/aA0QmDk.png)



![image-20230726115341847](https://i.imgur.com/xlbSTdw.png)

reactive value :state,propsä»¥åŠDerived state/function/props

**Attention:in real-world  app,a library like react-query should be used to featch data  on component mount**

![image-20230726120750982](https://i.imgur.com/f26KT2R.png)



```js
  useEffect(() => {
    setDuration((number * sets * speed) / 60 + (sets - 1) * durationBreak);
  }, [number, sets, speed, durationBreak]);
```

åœ¨useEffectä¸­æ›´æ–°çŠ¶æ€,è¿™å¾ˆå¯èƒ½å¯¼è‡´ä¸¤æ¬¡æ¸²æŸ“.



<img src="https://s2.loli.net/2023/08/26/YLMDzqknXVfsmKb.png" alt="image-20230826194558540" style="zoom:80%;" />

#### Render props pattern

ä¸»è¦æ˜¯çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶ä¸åŒçš„å‚æ•°renderç”¨äºæ¸²æŸ“å­ç»„ä»¶çš„å†…å®¹

#### Compound components pattern

```js
  <Counter>
        <Counter.Label>this is a counter</Counter.Label>
        <Counter.Count />
        <Counter.Increase icon="+" />
        <Counter.Decrease icon="-" />
      </Counter>
```



```js
import { useState, createContext, useContext } from "react";

// 1. create Context
const CounterContext = createContext();
// 2.create parent componente
export default function Counter({ children }) {
  const [count, setCount] = useState(0);
  const increase = () => setCount((c) => c + 1);
  const decrease = () => setCount((c) => c - 1);

  return (
    <CounterContext.Provider value={{ count, increase, decrease }}>
      <span>{children}</span>
    </CounterContext.Provider>
  );
}

// 3. create childr element to help implementing the common
function Count() {
  const { count } = useContext(CounterContext);
  return <span>{count}</span>;
}

function Label({ children }) {
  return <span>{children}</span>;
}

function Increase({ icon }) {
  const { increase } = useContext(CounterContext);
  return <button onClick={increase}>{icon}</button>;
}

function Decrease({ icon }) {
  const { decrease } = useContext(CounterContext);
  return <button onClick={decrease}>{icon}</button>;
}
// 4. Add child components  as properties to parent components
Counter.Count = Count;
Counter.Label = Label;
Counter.Increase = Increase;
Counter.Decrease = Decrease;

```



### React Portal

æœ¬è´¨ä¸Šå…è®¸å‘ˆç°çˆ¶ç»„ä»¶DOMç»“æ„ä¹‹å¤–çš„å…ƒç´ ,åŒæ—¶ä»å°†å…ƒç´ ä¿æŒåœ¨ç»„ä»¶æ ‘çš„åŸå§‹ä½ç½®.

æ–¹ä¾¿ä½¿ç”¨æ¨¡æ€çª—å£,å·¥å…·æç¤º,èœå•.









































































### å¥½ç”¨çš„åº“

1.OMDB IMDB

ç”µå½±API

2.LeafLet åœ°å›¾



3.[BigDataCloud API - Precise fast and affordable Next Gen API](https://www.bigdatacloud.com/)







